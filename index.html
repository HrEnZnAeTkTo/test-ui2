<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EscControl - –°–∏—Å—Ç–µ–º–∞ –∫–æ–Ω—Ç—Ä–æ–ª—è —ç—Å–∫–∞–ª–∞—Ç–æ—Ä–æ–≤</title>
    <style>
        :root {
            --primary-color: #2563eb;
            --secondary-color: #64748b;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --info-color: #06b6d4;
            
            /* Light theme */
            --bg-primary: #ffffff;
            --bg-secondary: #f8fafc;
            --bg-tertiary: #f1f5f9;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --border-color: #e2e8f0;
            --shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
        }

        [data-theme="dark"] {
            --bg-primary: #0f172a;
            --bg-secondary: #1e293b;
            --bg-tertiary: #334155;
            --text-primary: #f8fafc;
            --text-secondary: #cbd5e1;
            --border-color: #475569;
            --shadow: 0 1px 3px 0 rgb(0 0 0 / 0.3), 0 1px 2px -1px rgb(0 0 0 / 0.3);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.3), 0 4px 6px -4px rgb(0 0 0 / 0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background-color: var(--bg-secondary);
            color: var(--text-primary);
            line-height: 1.6;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1rem;
        }

        /* Header */
        .header {
            background-color: var(--bg-primary);
            border-bottom: 1px solid var(--border-color);
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 0;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary-color);
        }

        .nav {
            display: flex;
            gap: 2rem;
        }

        .nav-link {
            color: var(--text-secondary);
            text-decoration: none;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            transition: all 0.2s;
        }

        .nav-link:hover, .nav-link.active {
            color: var(--primary-color);
            background-color: var(--bg-tertiary);
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .theme-toggle {
            background: none;
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
            padding: 0.5rem;
            cursor: pointer;
            color: var(--text-primary);
            transition: all 0.2s;
        }

        .theme-toggle:hover {
            background-color: var(--bg-tertiary);
        }

        /* Main Content */
        .main {
            padding: 2rem 0;
        }

        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        /* Cards */
        .card {
            background-color: var(--bg-primary);
            border-radius: 0.75rem;
            padding: 1.5rem;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
            margin-bottom: 1.5rem;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .card-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: linear-gradient(135deg, var(--primary-color), #3b82f6);
            color: white;
            padding: 1.5rem;
            border-radius: 0.75rem;
            text-align: center;
        }

        .stat-card.success {
            background: linear-gradient(135deg, var(--success-color), #22c55e);
        }

        .stat-card.warning {
            background: linear-gradient(135deg, var(--warning-color), #eab308);
        }

        .stat-card.danger {
            background: linear-gradient(135deg, var(--danger-color), #f87171);
        }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            display: block;
        }

        .stat-label {
            font-size: 0.875rem;
            opacity: 0.9;
        }

        /* Buttons */
        .btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1rem;
            border: none;
            border-radius: 0.5rem;
            cursor: pointer;
            font-size: 0.875rem;
            font-weight: 500;
            text-decoration: none;
            transition: all 0.2s;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background-color: #1d4ed8;
        }

        .btn-success {
            background-color: var(--success-color);
            color: white;
        }

        .btn-warning {
            background-color: var(--warning-color);
            color: white;
        }

        .btn-danger {
            background-color: var(--danger-color);
            color: white;
        }

        .btn-secondary {
            background-color: var(--bg-tertiary);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        /* Tables */
        .table-container {
            overflow-x: auto;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
        }

        .table th,
        .table td {
            text-align: left;
            padding: 0.75rem;
            border-bottom: 1px solid var(--border-color);
        }

        .table th {
            background-color: var(--bg-tertiary);
            font-weight: 600;
            color: var(--text-primary);
        }

        .table tr:hover {
            background-color: var(--bg-tertiary);
        }

        /* Status badges */
        .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .status-badge.working {
            background-color: #dcfce7;
            color: #166534;
        }

        .status-badge.not-working {
            background-color: #fee2e2;
            color: #991b1b;
        }

        .status-badge.maintenance {
            background-color: #fef3c7;
            color: #92400e;
        }

        .status-badge.open {
            background-color: #dbeafe;
            color: #1e40af;
        }

        .status-badge.closed {
            background-color: #f3f4f6;
            color: #374151;
        }

        .status-badge.in-progress {
            background-color: #fef3c7;
            color: #92400e;
        }

        [data-theme="dark"] .status-badge.working {
            background-color: #064e3b;
            color: #6ee7b7;
        }

        [data-theme="dark"] .status-badge.not-working {
            background-color: #7f1d1d;
            color: #fca5a5;
        }

        [data-theme="dark"] .status-badge.maintenance {
            background-color: #78350f;
            color: #fcd34d;
        }

        /* Filter bar */
        .filter-bar {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .filter-label {
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--text-secondary);
        }

        .filter-input {
            padding: 0.5rem;
            border: 1px solid var(--border-color);
            border-radius: 0.375rem;
            background-color: var(--bg-primary);
            color: var(--text-primary);
        }

        /* Metro Map */
        .metro-map {
            position: relative;
            background: linear-gradient(135deg, #e6f3ff 0%, #f0f8ff 100%);
            border-radius: 0.75rem;
            height: 600px;
            overflow: hidden;
            border: 1px solid var(--border-color);
        }

        [data-theme="dark"] .metro-map {
            background: linear-gradient(135deg, #1e3a5f 0%, #2a4a6b 100%);
        }

        .map-controls {
            position: absolute;
            top: 1rem;
            right: 1rem;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            z-index: 10;
        }

        .map-zoom-controls {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .map-info {
            position: absolute;
            bottom: 1rem;
            left: 1rem;
            background: var(--bg-primary);
            padding: 1rem;
            border-radius: 0.5rem;
            border: 1px solid var(--border-color);
            max-width: 250px;
            box-shadow: var(--shadow);
        }

        .map-coordinate-display {
            position: absolute;
            top: 1rem;
            left: 1rem;
            background: var(--bg-primary);
            padding: 0.5rem;
            border-radius: 0.375rem;
            border: 1px solid var(--border-color);
            font-size: 0.75rem;
            color: var(--text-secondary);
        }

        /* Station details */
        .escalator-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 1rem;
        }

        .escalator-card {
            background-color: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
            padding: 1rem;
        }

        .escalator-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .escalator-number {
            font-weight: 600;
            color: var(--text-primary);
        }

        /* Charts placeholder */
        .chart {
            height: 300px;
            background: linear-gradient(45deg, var(--bg-tertiary), var(--bg-primary));
            border-radius: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-secondary);
            border: 1px solid var(--border-color);
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            padding: 2rem;
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background-color: var(--bg-primary);
            border-radius: 0.75rem;
            padding: 2rem;
            max-width: 500px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-secondary);
        }

        /* Export controls */
        .export-controls {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .export-select {
            padding: 0.375rem 0.75rem;
            border: 1px solid var(--border-color);
            border-radius: 0.375rem;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            font-size: 0.875rem;
        }

        .export-btn {
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        /* Mobile styles */
        .mobile-menu-toggle{
            display:none;
            background:none;
            border:1px solid var(--border-color);
            border-radius:.5rem;
            padding:.5rem;
            font-size:1.1rem;
            line-height:1;
            cursor: pointer;
        }

        .mobile-nav{
            position:fixed; inset:0; background:rgba(0,0,0,.45);
            backdrop-filter:saturate(120%) blur(2px);
            opacity:0; pointer-events:none; transition:opacity .2s ease;
            z-index:1000;
        }
        .mobile-nav.active{ opacity:1; pointer-events:auto; }
        .mobile-nav-content{
            position:absolute; top:0; right:0; height:100%;
            width:min(360px,82vw);
            background:var(--bg-primary);
            border-left:1px solid var(--border-color);
            box-shadow:var(--shadow-lg);
            transform:translateX(100%);
            transition:transform .25s ease;
        }
        .mobile-nav.active .mobile-nav-content{ transform:translateX(0); }
        .mobile-nav-header{
            display:flex; align-items:center; justify-content:space-between;
            padding:1rem; border-bottom:1px solid var(--border-color);
        }
        .mobile-nav-links{ display:flex; flex-direction:column; padding:.5rem; gap:.25rem; }
        .mobile-nav-link{
            display:block; padding:.75rem 1rem; border-radius:.5rem;
            color:var(--text-primary); text-decoration:none;
        }
        .mobile-nav-link:hover, .mobile-nav-link.active{ background:var(--bg-tertiary); }

        .mobile-nav-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-secondary);
        }

        #map-info-mobile{
            position:fixed; left:0; right:0; bottom:0;
            background:var(--bg-primary);
            border-top:1px solid var(--border-color);
            box-shadow:var(--shadow-lg);
            transform:translateY(110%);
            transition:transform .25s ease;
            z-index:1000;
            padding:1rem 1rem calc(1rem + env(safe-area-inset-bottom));
            display: none;
        }
        #map-info-mobile.active{ transform:translateY(0); }

        .mobile-controls{
            position:fixed; right:1rem;
            bottom:calc(1rem + env(safe-area-inset-bottom));
            z-index:1100; display:none;
        }

        .mobile-controls-toggle{
            width:56px; height:56px; border-radius:50%; border:none;
            box-shadow:var(--shadow-lg); background:var(--primary-color);
            color:#fff; font-size:1.25rem; display:flex; align-items:center; justify-content:center;
            cursor: pointer;
        }
        .mobile-controls-panel{
            position:fixed; left:1rem; right:1rem;
            bottom:calc(5.5rem + env(safe-area-inset-bottom));
            background:var(--bg-primary);
            border:1px solid var(--border-color);
            border-radius:1rem; box-shadow:var(--shadow-lg);
            transform:translateY(120%); opacity:0; pointer-events:none;
            transition:transform .25s ease, opacity .2s ease;
        }
        .mobile-controls-panel.active{ transform:translateY(0); opacity:1; pointer-events:auto; }
        .mobile-controls-grid{
            display:grid; grid-template-columns:repeat(3,1fr);
            gap:.5rem; padding:.75rem;
        }
        .mobile-control-btn{
            display:flex; flex-direction:column; align-items:center; justify-content:center;
            gap:.25rem; padding:.75rem; min-height:64px;
            border:1px solid var(--border-color); border-radius:.75rem;
            background:var(--bg-secondary); font-size:.875rem;
            cursor: pointer;
        }
        .mobile-control-btn:active{ transform:scale(.98); }

        @media (max-width: 768px) {
            .nav {
                display: none;
            }
            
            .mobile-menu-toggle{
                display:inline-flex;align-items:center;justify-content:center
            }
            
            .filter-bar {
                flex-direction: column;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .escalator-grid {
                grid-template-columns: 1fr;
            }

            .map-controls{ 
                display:none; 
            }

            #map-info-desktop{ 
                display:none; 
            }

            #map-info-mobile{ 
                display:block; 
            }

            .mobile-controls{ 
                display:block; 
            }
        }

        @media (max-width:480px){
            .stats-grid{ grid-template-columns:1fr; }
            .chart{ height:220px; }
            .header-content{ padding:.75rem 0; }
            .logo{ font-size:1.25rem; }
            .table th, .table td{ padding:.5rem; }
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div style="display: flex; align-items: center; gap: 1rem;">
                    <button class="mobile-menu-toggle" id="mobile-menu-toggle">
                        ‚ò∞
                    </button>
                    <div class="logo">
                        üöá EscControl
                    </div>
                </div>
                <nav class="nav">
                    <a href="#" class="nav-link active" data-page="dashboard">–î–∞—à–±–æ—Ä–¥</a>
                    <a href="#" class="nav-link" data-page="map">–ö–∞—Ä—Ç–∞ –º–µ—Ç—Ä–æ</a>
                    <a href="#" class="nav-link" data-page="stations">–°—Ç–∞–Ω—Ü–∏–∏</a>
                    <a href="#" class="nav-link" data-page="incidents">–ò–Ω—Ü–∏–¥–µ–Ω—Ç—ã</a>
                    <a href="#" class="nav-link" data-page="analytics">–ê–Ω–∞–ª–∏—Ç–∏–∫–∞</a>
                </nav>
                <div class="header-actions">
                    <button class="theme-toggle" id="theme-toggle">
                        üåô
                    </button>
                    <div class="user-info" style="display: none;">
                        –û–ø–µ—Ä–∞—Ç–æ—Ä: –ò–≤–∞–Ω–æ–≤ –ò.–ò.
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Mobile Navigation -->
    <div class="mobile-nav" id="mobile-nav">
        <div class="mobile-nav-content">
            <div class="mobile-nav-header">
                <div class="logo">
                    üöá EscControl
                </div>
                <button class="mobile-nav-close" id="mobile-nav-close">
                    √ó
                </button>
            </div>
            <div class="mobile-nav-links">
                <a href="#" class="mobile-nav-link active" data-page="dashboard">üìä –î–∞—à–±–æ—Ä–¥</a>
                <a href="#" class="mobile-nav-link" data-page="map">üó∫Ô∏è –ö–∞—Ä—Ç–∞ –º–µ—Ç—Ä–æ</a>
                <a href="#" class="mobile-nav-link" data-page="stations">üöá –°—Ç–∞–Ω—Ü–∏–∏</a>
                <a href="#" class="mobile-nav-link" data-page="incidents">‚ö†Ô∏è –ò–Ω—Ü–∏–¥–µ–Ω—Ç—ã</a>
                <a href="#" class="mobile-nav-link" data-page="analytics">üìà –ê–Ω–∞–ª–∏—Ç–∏–∫–∞</a>
                <div style="margin-top: 2rem; padding-top: 1rem; border-top: 1px solid var(--border-color);">
                    <div style="font-size: 0.875rem; color: var(--text-secondary);">
                        –û–ø–µ—Ä–∞—Ç–æ—Ä: –ò–≤–∞–Ω–æ–≤ –ò.–ò.
                    </div>
                </div>
            </div>
        </div>
    </div>

    <main class="main">
        <div class="container">
            <!-- Dashboard Page -->
            <div class="page active" id="dashboard">
                <h1 style="margin-bottom: 2rem;">–î–∞—à–±–æ—Ä–¥ —Å–∏—Å—Ç–µ–º—ã –∫–æ–Ω—Ç—Ä–æ–ª—è</h1>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <span class="stat-value">156</span>
                        <span class="stat-label">–í—Å–µ–≥–æ —ç—Å–∫–∞–ª–∞—Ç–æ—Ä–æ–≤</span>
                    </div>
                    <div class="stat-card success">
                        <span class="stat-value">148</span>
                        <span class="stat-label">–†–∞–±–æ—Ç–∞—é—â–∏—Ö</span>
                    </div>
                    <div class="stat-card warning">
                        <span class="stat-value">5</span>
                        <span class="stat-label">–í –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–∏</span>
                    </div>
                    <div class="stat-card danger">
                        <span class="stat-value">3</span>
                        <span class="stat-label">–ù–µ —Ä–∞–±–æ—Ç–∞—é—Ç</span>
                    </div>
                </div>

                <div class="filter-bar">
                    <div class="filter-group">
                        <label class="filter-label">–î–∞—Ç–∞ —Å</label>
                        <input type="date" class="filter-input" value="2025-09-01">
                    </div>
                    <div class="filter-group">
                        <label class="filter-label">–î–∞—Ç–∞ –ø–æ</label>
                        <input type="date" class="filter-input" value="2025-09-21">
                    </div>
                    <div class="filter-group">
                        <label class="filter-label">–°—Ç–∞–Ω—Ü–∏—è</label>
                        <select class="filter-input">
                            <option>–í—Å–µ —Å—Ç–∞–Ω—Ü–∏–∏</option>
                            <option>–°–æ–∫–æ–ª—å–Ω–∏–∫–∏</option>
                            <option>–ö—Ä–∞—Å–Ω—ã–µ –≤–æ—Ä–æ—Ç–∞</option>
                            <option>–ß–∏—Å—Ç—ã–µ –ø—Ä—É–¥—ã</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label class="filter-label">–¢–∏–ø –∏–Ω—Ü–∏–¥–µ–Ω—Ç–∞</label>
                        <select class="filter-input">
                            <option>–í—Å–µ —Ç–∏–ø—ã</option>
                            <option>–û—Å—Ç–∞–Ω–æ–≤–∫–∞ —ç—Å–∫–∞–ª–∞—Ç–æ—Ä–∞</option>
                            <option>–ü–∞–¥–µ–Ω–∏–µ —á–µ–ª–æ–≤–µ–∫–∞</option>
                            <option>–ü–æ—Å—Ç–æ—Ä–æ–Ω–Ω–∏–π –ø—Ä–µ–¥–º–µ—Ç</option>
                        </select>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">–ü–æ—Å–ª–µ–¥–Ω–∏–µ –∏–Ω—Ü–∏–¥–µ–Ω—Ç—ã</h2>
                        <button class="btn btn-primary">–í—Å–µ –∏–Ω—Ü–∏–¥–µ–Ω—Ç—ã</button>
                    </div>
                    <div class="table-container">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>–í—Ä–µ–º—è</th>
                                    <th>–°—Ç–∞–Ω—Ü–∏—è</th>
                                    <th>–≠—Å–∫–∞–ª–∞—Ç–æ—Ä</th>
                                    <th>–¢–∏–ø</th>
                                    <th>–°—Ç–∞—Ç—É—Å</th>
                                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>21.09.2025 14:35</td>
                                    <td>–°–æ–∫–æ–ª—å–Ω–∏–∫–∏</td>
                                    <td>‚Ññ3</td>
                                    <td>–û—Å—Ç–∞–Ω–æ–≤–∫–∞ —ç—Å–∫–∞–ª–∞—Ç–æ—Ä–∞</td>
                                    <td><span class="status-badge open">–û—Ç–∫—Ä—ã—Ç</span></td>
                                    <td>
                                        <button class="btn btn-secondary">–ü—Ä–æ—Å–º–æ—Ç—Ä</button>
                                    </td>
                                </tr>
                                <tr>
                                    <td>21.09.2025 13:22</td>
                                    <td>–ö—Ä–∞—Å–Ω—ã–µ –≤–æ—Ä–æ—Ç–∞</td>
                                    <td>‚Ññ1</td>
                                    <td>–ü–æ—Å—Ç–æ—Ä–æ–Ω–Ω–∏–π –ø—Ä–µ–¥–º–µ—Ç</td>
                                    <td><span class="status-badge in-progress">–í —Ä–∞–±–æ—Ç–µ</span></td>
                                    <td>
                                        <button class="btn btn-secondary">–ü—Ä–æ—Å–º–æ—Ç—Ä</button>
                                    </td>
                                </tr>
                                <tr>
                                    <td>21.09.2025 12:10</td>
                                    <td>–ß–∏—Å—Ç—ã–µ –ø—Ä—É–¥—ã</td>
                                    <td>‚Ññ2</td>
                                    <td>–ü–∞–¥–µ–Ω–∏–µ —á–µ–ª–æ–≤–µ–∫–∞</td>
                                    <td><span class="status-badge closed">–ó–∞–∫—Ä—ã—Ç</span></td>
                                    <td>
                                        <button class="btn btn-secondary">–ü—Ä–æ—Å–º–æ—Ç—Ä</button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –¥–Ω—è–º</h2>
                    </div>
                    <div class="chart">
                        üìä –ì—Ä–∞—Ñ–∏–∫ –∏–Ω—Ü–∏–¥–µ–Ω—Ç–æ–≤ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π
                    </div>
                </div>
            </div>

            <!-- Metro Map Page -->
            <div class="page" id="map">
                <h1 style="margin-bottom: 2rem;">–ö–∞—Ä—Ç–∞ –º–µ—Ç—Ä–æ</h1>
                
                <div class="card">
                    <div class="metro-map" id="metro-map">
                        <div class="map-coordinate-display" id="coord-display">
                            –¢–µ–ø–ª–æ–≤–∞—è –∫–∞—Ä—Ç–∞: –∏–Ω—Ü–∏–¥–µ–Ω—Ç—ã –∑–∞ 24—á
                        </div>
                        
                        <!-- Desktop Controls -->
                        <div class="map-controls">
                            <div class="map-zoom-controls">
                                <button class="btn btn-secondary" onclick="zoomMap(1.2)">üîç+</button>
                                <button class="btn btn-secondary" onclick="zoomMap(0.8)">üîç-</button>
                            </div>
                            <button class="btn btn-secondary" onclick="centerMap()">üéØ</button>
                            <button class="btn btn-secondary" onclick="toggleHeatmap()">üå°Ô∏è</button>
                            <button class="btn btn-secondary" onclick="resetView()">‚ü≤</button>
                        </div>
                        
                        <!-- SVG –∫–∞—Ä—Ç–∞ –º–µ—Ç—Ä–æ –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–∞ –∑–¥–µ—Å—å -->
                        <div id="svg-container" style="width: 100%; height: 100%; overflow: hidden;">
                            <!-- SVG –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                        </div>
                        
                        <!-- Desktop Map Info -->
                        <div class="map-info" id="map-info-desktop">
                            <strong>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å—Ç–∞–Ω—Ü–∏–∏:</strong><br>
                            <div id="station-info">
                                –ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ —Å—Ç–∞–Ω—Ü–∏—é –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
                            </div>
                            <hr style="margin: 0.5rem 0; border-color: var(--border-color);">
                            <div style="font-size: 0.875rem;">
                                <strong>–¢–µ–ø–ª–æ–≤–∞—è –∫–∞—Ä—Ç–∞ (–∏–Ω—Ü–∏–¥–µ–Ω—Ç—ã –∑–∞ 24—á):</strong><br>
                                <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.25rem;">
                                    <div style="width: 12px; height: 12px; background: #22c55e; border-radius: 50%;"></div>
                                    0 –∏–Ω—Ü–∏–¥–µ–Ω—Ç–æ–≤
                                </div>
                                <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.25rem;">
                                    <div style="width: 12px; height: 12px; background: #f59e0b; border-radius: 50%;"></div>
                                    1-2 –∏–Ω—Ü–∏–¥–µ–Ω—Ç–∞
                                </div>
                                <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.25rem;">
                                    <div style="width: 12px; height: 12px; background: #ef4444; border-radius: 50%; animation: pulse 2s infinite;"></div>
                                    3+ –∏–Ω—Ü–∏–¥–µ–Ω—Ç–æ–≤
                                </div>
                                <div style="display: flex; align-items: center; gap: 0.5rem;">
                                    <div style="width: 12px; height: 12px; background: #6b7280; border-radius: 50%;"></div>
                                    –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Mobile Map Info Panel -->
                <div class="map-info" id="map-info-mobile">
                    <div style="display: flex; justify-content: between; align-items: flex-start; margin-bottom: 0.5rem;">
                        <strong>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å—Ç–∞–Ω—Ü–∏–∏</strong>
                        <button onclick="toggleMobileMapInfo()" style="background: none; border: none; font-size: 1.25rem; color: var(--text-secondary); cursor: pointer; margin-left: auto;">√ó</button>
                    </div>
                    <div id="station-info-mobile">
                        –ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ —Å—Ç–∞–Ω—Ü–∏—é –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
                    </div>
                </div>

                <!-- Mobile Controls -->
                <div class="mobile-controls">
                    <button class="mobile-controls-toggle" id="mobile-controls-toggle">
                        ‚öôÔ∏è
                    </button>
                    <div class="mobile-controls-panel" id="mobile-controls-panel">
                        <div class="mobile-controls-grid">
                            <button class="mobile-control-btn" onclick="zoomMap(1.3)">
                                <span class="icon">üîç</span>
                                <span>–£–≤–µ–ª–∏—á–∏—Ç—å</span>
                            </button>
                            <button class="mobile-control-btn" onclick="zoomMap(0.7)">
                                <span class="icon">üîç</span>
                                <span>–£–º–µ–Ω—å—à–∏—Ç—å</span>
                            </button>
                            <button class="mobile-control-btn" onclick="centerMap()">
                                <span class="icon">üéØ</span>
                                <span>–¶–µ–Ω—Ç—Ä</span>
                            </button>
                            <button class="mobile-control-btn" onclick="toggleHeatmap()">
                                <span class="icon">üå°Ô∏è</span>
                                <span>–¢–µ–ø–ª–æ–≤–∞—è</span>
                            </button>
                            <button class="mobile-control-btn" onclick="resetView()">
                                <span class="icon">‚ü≤</span>
                                <span>–°–±—Ä–æ—Å</span>
                            </button>
                            <button class="mobile-control-btn" onclick="showMapLegend()">
                                <span class="icon">‚ÑπÔ∏è</span>
                                <span>–õ–µ–≥–µ–Ω–¥–∞</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Stations Page -->
            <div class="page" id="stations">
                <h1 style="margin-bottom: 2rem;">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–∞–Ω—Ü–∏—è–º–∏</h1>
                
                <div class="filter-bar">
                    <div class="filter-group">
                        <label class="filter-label">–ü–æ–∏—Å–∫ —Å—Ç–∞–Ω—Ü–∏–∏</label>
                        <input type="text" class="filter-input" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Å—Ç–∞–Ω—Ü–∏–∏...">
                    </div>
                    <div class="filter-group">
                        <label class="filter-label">–õ–∏–Ω–∏—è</label>
                        <select class="filter-input">
                            <option>–í—Å–µ –ª–∏–Ω–∏–∏</option>
                            <option>–°–æ–∫–æ–ª—å–Ω–∏—á–µ—Å–∫–∞—è</option>
                            <option>–ó–∞–º–æ—Å–∫–≤–æ—Ä–µ—Ü–∫–∞—è</option>
                            <option>–ê—Ä–±–∞—Ç—Å–∫–æ-–ü–æ–∫—Ä–æ–≤—Å–∫–∞—è</option>
                        </select>
                    </div>
                </div>

                <div class="escalator-grid">
                    <div class="escalator-card">
                        <div class="escalator-header">
                            <div>
                                <div class="escalator-number">–°–æ–∫–æ–ª—å–Ω–∏–∫–∏ - –≠—Å–∫–∞–ª–∞—Ç–æ—Ä ‚Ññ1</div>
                                <div style="font-size: 0.875rem; color: var(--text-secondary);">–°–æ–∫–æ–ª—å–Ω–∏—á–µ—Å–∫–∞—è –ª–∏–Ω–∏—è</div>
                            </div>
                            <span class="status-badge working">–†–∞–±–æ—Ç–∞–µ—Ç</span>
                        </div>
                        <div style="margin: 1rem 0;">
                            <div>–ö–∞–º–µ—Ä—ã: 2 –∞–∫—Ç–∏–≤–Ω—ã–µ</div>
                            <div>–ü–æ—Å–ª–µ–¥–Ω–∏–π –∏–Ω—Ü–∏–¥–µ–Ω—Ç: 20.09.2025</div>
                        </div>
                        <div style="display: flex; gap: 0.5rem;">
                            <button class="btn btn-primary" onclick="viewStation('sokol')">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</button>
                            <button class="btn btn-warning">–°–∏–º—É–ª—è—Ü–∏—è</button>
                        </div>
                    </div>

                    <div class="escalator-card">
                        <div class="escalator-header">
                            <div>
                                <div class="escalator-number">–ö—Ä–∞—Å–Ω—ã–µ –≤–æ—Ä–æ—Ç–∞ - –≠—Å–∫–∞–ª–∞—Ç–æ—Ä ‚Ññ3</div>
                                <div style="font-size: 0.875rem; color: var(--text-secondary);">–°–æ–∫–æ–ª—å–Ω–∏—á–µ—Å–∫–∞—è –ª–∏–Ω–∏—è</div>
                            </div>
                            <span class="status-badge not-working">–ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç</span>
                        </div>
                        <div style="margin: 1rem 0;">
                            <div>–ö–∞–º–µ—Ä—ã: 1 –∞–∫—Ç–∏–≤–Ω–∞—è</div>
                            <div style="color: var(--danger-color);">–ê–∫—Ç–∏–≤–Ω—ã–π –∏–Ω—Ü–∏–¥–µ–Ω—Ç: –û—Å—Ç–∞–Ω–æ–≤–∫–∞</div>
                        </div>
                        <div style="display: flex; gap: 0.5rem;">
                            <button class="btn btn-primary" onclick="viewStation('red-gates')">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</button>
                            <button class="btn btn-danger">–ê–≤–∞—Ä–∏–π–Ω–∞—è</button>
                        </div>
                    </div>

                    <div class="escalator-card">
                        <div class="escalator-header">
                            <div>
                                <div class="escalator-number">–ß–∏—Å—Ç—ã–µ –ø—Ä—É–¥—ã - –≠—Å–∫–∞–ª–∞—Ç–æ—Ä ‚Ññ2</div>
                                <div style="font-size: 0.875rem; color: var(--text-secondary);">–°–æ–∫–æ–ª—å–Ω–∏—á–µ—Å–∫–∞—è –ª–∏–Ω–∏—è</div>
                            </div>
                            <span class="status-badge maintenance">–û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ</span>
                        </div>
                        <div style="margin: 1rem 0;">
                            <div>–ö–∞–º–µ—Ä—ã: 2 –∞–∫—Ç–∏–≤–Ω—ã–µ</div>
                            <div>–ü–ª–∞–Ω–æ–≤–æ–µ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ –¥–æ 22.09.2025</div>
                        </div>
                        <div style="display: flex; gap: 0.5rem;">
                            <button class="btn btn-primary" onclick="viewStation('clean-ponds')">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</button>
                            <button class="btn btn-success">–ó–∞–≤–µ—Ä—à–∏—Ç—å</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Incidents Page -->
            <div class="page" id="incidents">
                <h1 style="margin-bottom: 2rem;">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–Ω—Ü–∏–¥–µ–Ω—Ç–∞–º–∏</h1>
                
                <div class="filter-bar">
                    <div class="filter-group">
                        <label class="filter-label">–°—Ç–∞—Ç—É—Å</label>
                        <select class="filter-input">
                            <option>–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã</option>
                            <option>–û—Ç–∫—Ä—ã—Ç</option>
                            <option>–í —Ä–∞–±–æ—Ç–µ</option>
                            <option>–ó–∞–∫—Ä—ã—Ç</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label class="filter-label">–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç</label>
                        <select class="filter-input">
                            <option>–í—Å–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã</option>
                            <option>–í—ã—Å–æ–∫–∏–π</option>
                            <option>–°—Ä–µ–¥–Ω–∏–π</option>
                            <option>–ù–∏–∑–∫–∏–π</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label class="filter-label">–î–∞—Ç–∞</label>
                        <input type="date" class="filter-input" value="2025-09-21">
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">–°–ø–∏—Å–æ–∫ –∏–Ω—Ü–∏–¥–µ–Ω—Ç–æ–≤</h2>
                        <button class="btn btn-primary" onclick="createIncident()">–°–æ–∑–¥–∞—Ç—å –∏–Ω—Ü–∏–¥–µ–Ω—Ç</button>
                    </div>
                    <div class="table-container">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>–í—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è</th>
                                    <th>–°—Ç–∞–Ω—Ü–∏—è/–≠—Å–∫–∞–ª–∞—Ç–æ—Ä</th>
                                    <th>–¢–∏–ø –∏–Ω—Ü–∏–¥–µ–Ω—Ç–∞</th>
                                    <th>–£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å AI</th>
                                    <th>–°—Ç–∞—Ç—É—Å</th>
                                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>#1001</td>
                                    <td>21.09.2025 14:35:42</td>
                                    <td>–°–æ–∫–æ–ª—å–Ω–∏–∫–∏ / ‚Ññ3</td>
                                    <td>–û—Å—Ç–∞–Ω–æ–≤–∫–∞ —ç—Å–∫–∞–ª–∞—Ç–æ—Ä–∞</td>
                                    <td>95%</td>
                                    <td><span class="status-badge open">–û—Ç–∫—Ä—ã—Ç</span></td>
                                    <td>
                                        <button class="btn btn-secondary" onclick="viewIncident(1001)">–ü—Ä–æ—Å–º–æ—Ç—Ä</button>
                                        <button class="btn btn-primary">–í —Ä–∞–±–æ—Ç—É</button>
                                    </td>
                                </tr>
                                <tr>
                                    <td>#1000</td>
                                    <td>21.09.2025 13:22:15</td>
                                    <td>–ö—Ä–∞—Å–Ω—ã–µ –≤–æ—Ä–æ—Ç–∞ / ‚Ññ1</td>
                                    <td>–ü–æ—Å—Ç–æ—Ä–æ–Ω–Ω–∏–π –ø—Ä–µ–¥–º–µ—Ç</td>
                                    <td>87%</td>
                                    <td><span class="status-badge in-progress">–í —Ä–∞–±–æ—Ç–µ</span></td>
                                    <td>
                                        <button class="btn btn-secondary" onclick="viewIncident(1000)">–ü—Ä–æ—Å–º–æ—Ç—Ä</button>
                                        <button class="btn btn-success">–ó–∞–∫—Ä—ã—Ç—å</button>
                                    </td>
                                </tr>
                                <tr>
                                    <td>#999</td>
                                    <td>21.09.2025 12:10:33</td>
                                    <td>–ß–∏—Å—Ç—ã–µ –ø—Ä—É–¥—ã / ‚Ññ2</td>
                                    <td>–ü–∞–¥–µ–Ω–∏–µ —á–µ–ª–æ–≤–µ–∫–∞</td>
                                    <td>92%</td>
                                    <td><span class="status-badge closed">–ó–∞–∫—Ä—ã—Ç</span></td>
                                    <td>
                                        <button class="btn btn-secondary" onclick="viewIncident(999)">–ü—Ä–æ—Å–º–æ—Ç—Ä</button>
                                        <button class="btn btn-secondary">–ò—Å—Ç–æ—Ä–∏—è</button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Analytics Page -->
            <div class="page" id="analytics">
                <h1 style="margin-bottom: 2rem;">–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ –æ—Ç—á–µ—Ç—ã</h1>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-bottom: 2rem;">
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">–ò–Ω—Ü–∏–¥–µ–Ω—Ç—ã –ø–æ —Ç–∏–ø–∞–º</h2>
                            <div class="export-controls">
                                <select class="export-select" id="export-format-1">
                                    <option value="pdf">PDF</option>
                                    <option value="excel">Excel</option>
                                    <option value="png">PNG</option>
                                </select>
                                <button class="btn btn-secondary export-btn" onclick="exportChart('chart1')">
                                    üì• –≠–∫—Å–ø–æ—Ä—Ç
                                </button>
                            </div>
                        </div>
                        <div class="chart" id="chart1">
                            üìä –ö—Ä—É–≥–æ–≤–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞ —Ç–∏–ø–æ–≤ –∏–Ω—Ü–∏–¥–µ–Ω—Ç–æ–≤<br>
                            <small style="color: var(--text-secondary);">
                                –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —ç—Å–∫–∞–ª–∞—Ç–æ—Ä–∞: 45%<br>
                                –ü–æ—Å—Ç–æ—Ä–æ–Ω–Ω–∏–π –ø—Ä–µ–¥–º–µ—Ç: 30%<br>
                                –ü–∞–¥–µ–Ω–∏–µ —á–µ–ª–æ–≤–µ–∫–∞: 15%<br>
                                –î—Ä—É–≥–æ–µ: 10%
                            </small>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">–î–∏–Ω–∞–º–∏–∫–∞ –ø–æ –≤—Ä–µ–º–µ–Ω–∏</h2>
                            <div class="export-controls">
                                <select class="export-select" id="export-format-2">
                                    <option value="excel">Excel</option>
                                    <option value="pdf">PDF</option>
                                    <option value="png">PNG</option>
                                </select>
                                <button class="btn btn-secondary export-btn" onclick="exportChart('chart2')">
                                    üì• –≠–∫—Å–ø–æ—Ä—Ç
                                </button>
                            </div>
                        </div>
                        <div class="chart" id="chart2">
                            üìà –õ–∏–Ω–µ–π–Ω—ã–π –≥—Ä–∞—Ñ–∏–∫ –∏–Ω—Ü–∏–¥–µ–Ω—Ç–æ–≤ –≤–æ –≤—Ä–µ–º–µ–Ω–∏<br>
                            <small style="color: var(--text-secondary);">
                                –ü–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π: —Ç—Ä–µ–Ω–¥ —Å–Ω–∏–∂–µ–Ω–∏—è –Ω–∞ 12%
                            </small>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Å—Ç–∞–Ω—Ü–∏—è–º</h2>
                        <div class="export-controls">
                            <select class="export-select" id="export-format-3">
                                <option value="png">PNG</option>
                                <option value="pdf">PDF</option>
                                <option value="excel">Excel</option>
                            </select>
                            <button class="btn btn-secondary export-btn" onclick="exportChart('chart3')">
                                üì• –≠–∫—Å–ø–æ—Ä—Ç
                            </button>
                        </div>
                    </div>
                    <div class="chart" id="chart3">
                        üìä –ì–∏—Å—Ç–æ–≥—Ä–∞–º–º–∞ –∏–Ω—Ü–∏–¥–µ–Ω—Ç–æ–≤ –ø–æ —Å—Ç–∞–Ω—Ü–∏—è–º –º–µ—Ç—Ä–æ<br>
                        <small style="color: var(--text-secondary);">
                            –¢–æ–ø-3: –ö—Ä–∞—Å–Ω—ã–µ –≤–æ—Ä–æ—Ç–∞ (12), –°–æ–∫–æ–ª—å–Ω–∏–∫–∏ (8), –õ—É–±—è–Ω–∫–∞ (6)
                        </small>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–æ–≤</h2>
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1rem;">
                        <div style="display: flex; align-items: center; gap: 1rem;">
                            <button class="btn btn-primary" onclick="generateReport('daily')">üìÑ –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –æ—Ç—á–µ—Ç</button>
                            <div class="export-controls">
                                <select class="export-select" id="daily-format">
                                    <option value="pdf">PDF</option>
                                    <option value="excel">Excel</option>
                                </select>
                            </div>
                        </div>
                        
                        <div style="display: flex; align-items: center; gap: 1rem;">
                            <button class="btn btn-primary" onclick="generateReport('weekly')">üìä –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç</button>
                            <div class="export-controls">
                                <select class="export-select" id="weekly-format">
                                    <option value="pdf">PDF</option>
                                    <option value="excel">Excel</option>
                                </select>
                            </div>
                        </div>
                        
                        <div style="display: flex; align-items: center; gap: 1rem;">
                            <button class="btn btn-primary" onclick="generateReport('monthly')">üìà –ú–µ—Å—è—á–Ω—ã–π –æ—Ç—á–µ—Ç</button>
                            <div class="export-controls">
                                <select class="export-select" id="monthly-format">
                                    <option value="pdf">PDF</option>
                                    <option value="excel">Excel</option>
                                </select>
                            </div>
                        </div>
                        
                        <div style="display: flex; align-items: center; gap: 1rem;">
                            <button class="btn btn-primary" onclick="generateReport('station')">üöá –û—Ç—á–µ—Ç –ø–æ —Å—Ç–∞–Ω—Ü–∏–∏</button>
                            <div class="export-controls">
                                <select class="export-select" id="station-format">
                                    <option value="pdf">PDF</option>
                                    <option value="excel">Excel</option>
                                    <option value="png">PNG</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Modal for incident details -->
    <div class="modal" id="incident-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>–î–µ—Ç–∞–ª–∏ –∏–Ω—Ü–∏–¥–µ–Ω—Ç–∞ #1001</h3>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div style="margin-bottom: 1rem;">
                    <strong>–¢–∏–ø:</strong> –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —ç—Å–∫–∞–ª–∞—Ç–æ—Ä–∞<br>
                    <strong>–°—Ç–∞–Ω—Ü–∏—è:</strong> –°–æ–∫–æ–ª—å–Ω–∏–∫–∏<br>
                    <strong>–≠—Å–∫–∞–ª–∞—Ç–æ—Ä:</strong> ‚Ññ3<br>
                    <strong>–í—Ä–µ–º—è:</strong> 21.09.2025 14:35:42<br>
                    <strong>–£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å AI:</strong> 95%<br>
                    <strong>–°—Ç–∞—Ç—É—Å:</strong> <span class="status-badge open">–û—Ç–∫—Ä—ã—Ç</span>
                </div>
                <div style="margin-bottom: 1rem;">
                    <strong>–û–ø–∏—Å–∞–Ω–∏–µ:</strong><br>
                    –û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ —ç—Å–∫–∞–ª–∞—Ç–æ—Ä–∞ ‚Ññ3 –Ω–∞ —Å—Ç–∞–Ω—Ü–∏–∏ –°–æ–∫–æ–ª—å–Ω–∏–∫–∏. –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–ª–∞ –∞–Ω–æ–º–∞–ª–∏—é –≤ —Ä–∞–±–æ—Ç–µ –º–µ—Ö–∞–Ω–∏–∑–º–∞.
                </div>
                <div style="margin-bottom: 1rem;">
                    <strong>–í–∏–¥–µ–æ–∑–∞–ø–∏—Å—å:</strong><br>
                    <div class="chart" style="height: 200px;">
                        üé• –§—Ä–∞–≥–º–µ–Ω—Ç –≤–∏–¥–µ–æ —Å –∫–∞–º–µ—Ä—ã –Ω–∞–±–ª—é–¥–µ–Ω–∏—è
                    </div>
                </div>
                <div style="display: flex; gap: 1rem;">
                    <button class="btn btn-primary">–û—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ</button>
                    <button class="btn btn-success">–í–∑—è—Ç—å –≤ —Ä–∞–±–æ—Ç—É</button>
                    <button class="btn btn-danger">–ó–∞–∫—Ä—ã—Ç—å –∏–Ω—Ü–∏–¥–µ–Ω—Ç</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let currentZoom = 1;
        let svgElement = null;
        let showHeatmap = true;
        let panX = 0, panY = 0;
        let isDragging = false;
        let startX, startY;
        let isMobile = window.innerWidth <= 768;
        let mobileControlsOpen = false;
        let mapInfoOpen = false;

        // –ú–∞–ø–ø–∏–Ω–≥ –Ω–∞–∑–≤–∞–Ω–∏–π —Å—Ç–∞–Ω—Ü–∏–π –∫ –∏—Ö ID –≤ SVG
        const stationMapping = {
            '–°–æ–∫–æ–ª—å–Ω–∏–∫–∏': 's1_1_Sokolniki',
            '–ö—Ä–∞—Å–Ω–æ—Å–µ–ª—å–∫–∞—è': 's1_Krasnoselskaya',
            '–ö–æ–º—Å–æ–º–æ–ª—å—Å–∫–∞—è': 's1_1_Komsomolskaya',
            '–ö—Ä–∞—Å–Ω—ã–µ –≤–æ—Ä–æ—Ç–∞': 's1_Krasniye_Vorota',
            '–ß–∏—Å—Ç—ã–µ –ø—Ä—É–¥—ã': 's1_1_Chistye_Prudy',
            '–õ—É–±—è–Ω–∫–∞': 's1_2_Lubyanka',
            '–û—Ö–æ—Ç–Ω—ã–π —Ä—è–¥': 's1_1_Okhotny_Ryad',
            '–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –∏–º–µ–Ω–∏ –õ–µ–Ω–∏–Ω–∞': 's1_4_Biblioteka_Im_Lenina',
            '–ö—Ä–æ–ø–æ—Ç–∫–∏–Ω—Å–∫–∞—è': 's1_1_Kropotkinskaya',
            '–ü–∞—Ä–∫ –∫—É–ª—å—Ç—É—Ä—ã': 's1_2_Park_Kultury',
            '–§—Ä—É–Ω–∑–µ–Ω—Å–∫–∞—è': 's1_Frunzenskaya',
            '–°–ø–æ—Ä—Ç–∏–≤–Ω–∞—è': 's1_Sportivnaya',
            '–í–æ—Ä–æ–±—å—ë–≤—ã –≥–æ—Ä—ã': 's1_Vorobyovy_Gory',
            '–£–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç': 's1_Universitet',
            '–ü—Ä–æ—Å–ø–µ–∫—Ç –í–µ—Ä–Ω–∞–¥—Å–∫–æ–≥–æ': 's1_2_Prospekt_Vernadskogo',
            '–Æ–≥–æ-–ó–∞–ø–∞–¥–Ω–∞—è': 's1_Yugo_Zapadnaya',
            '–¢—Ä–æ–ø–∞—Ä—ë–≤–æ': 's1_Troparyovo',
            '–†—É–º—è–Ω—Ü–µ–≤–æ': 's1_Rumyantsevo',
            '–°–∞–ª–∞—Ä—å–µ–≤–æ': 's1_Salaryevo',
            '–†–µ—á–Ω–æ–π –≤–æ–∫–∑–∞–ª': 's2_Rechnoy_Vokzal',
            '–í–æ–¥–Ω—ã–π —Å—Ç–∞–¥–∏–æ–Ω': 's2_1_Vodny_Stadion',
            '–í–æ–π–∫–æ–≤—Å–∫–∞—è': 's2_4_Voykovskaya',
            '–°–æ–∫–æ–ª': 's2_Sokol',
            '–ê—ç—Ä–æ–ø–æ—Ä—Ç': 's2_Aeroport',
            '–î–∏–Ω–∞–º–æ': 's2_2_Dinamo',
            '–ë–µ–ª–æ—Ä—É—Å—Å–∫–∞—è': 's2_3_Belorusskaya',
            '–ú–∞—è–∫–æ–≤—Å–∫–∞—è': 's2_Mayakovskaya',
            '–¢–≤–µ—Ä—Å–∫–∞—è': 's2_7_Tverskaya',
            '–¢–µ–∞—Ç—Ä–∞–ª—å–Ω–∞—è': 's2_3_Teatralnaya',
            '–ù–æ–≤–æ–∫—É–∑–Ω–µ—Ü–∫–∞—è': 's2_2_Novokuznetskaya',
            '–ü–∞–≤–µ–ª–µ—Ü–∫–∞—è': 's2_3_Paveletskaya',
            '–ê–≤—Ç–æ–∑–∞–≤–æ–¥—Å–∫–∞—è': 's2_4_Avtozavodskaya',
            '–¢–µ—Ö–Ω–æ–ø–∞—Ä–∫': 's2_Tekhnopark',
            '–ö–æ–ª–æ–º–µ–Ω—Å–∫–∞—è': 's2_4_Kolomenskaya',
            '–ö–∞—à–∏—Ä—Å–∫–∞—è': 's2_3_Kashirskaya',
            '–ö–∞–Ω—Ç–µ–º–∏—Ä–æ–≤—Å–∫–∞—è': 's2_4_Kantemirovskaya',
            '–¶–∞—Ä–∏—Ü—ã–Ω–æ': 's2_4_Tsaritsyno',
            '–û—Ä–µ—Ö–æ–≤–æ': 's2_4_Orekhovo',
            '–î–æ–º–æ–¥–µ–¥–æ–≤—Å–∫–∞—è': 's2_4_Domodedovskaya',
            '–ö—Ä–∞—Å–Ω–æ–≥–≤–∞—Ä–¥–µ–π—Å–∫–∞—è': 's2_2_Krasnogvardeyskaya'
        };

        // –î–∞–Ω–Ω—ã–µ –æ–± –∏–Ω—Ü–∏–¥–µ–Ω—Ç–∞—Ö –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 24 —á–∞—Å–∞ (—Å–∏–º—É–ª—è—Ü–∏—è)
        const incidentData = {
            '–°–æ–∫–æ–ª—å–Ω–∏–∫–∏': 0,
            '–ö—Ä–∞—Å–Ω—ã–µ –≤–æ—Ä–æ—Ç–∞': 3,
            '–ß–∏—Å—Ç—ã–µ –ø—Ä—É–¥—ã': 1,
            '–õ—É–±—è–Ω–∫–∞': 0,
            '–û—Ö–æ—Ç–Ω—ã–π —Ä—è–¥': 2,
            '–¢–≤–µ—Ä—Å–∫–∞—è': 1,
            '–¢–µ–∞—Ç—Ä–∞–ª—å–Ω–∞—è': 0,
            '–ù–æ–≤–æ–∫—É–∑–Ω–µ—Ü–∫–∞—è': 0,
            '–ü–∞–≤–µ–ª–µ—Ü–∫–∞—è': 1,
            '–ê–≤—Ç–æ–∑–∞–≤–æ–¥—Å–∫–∞—è': 0,
            '–ö–∞—à–∏—Ä—Å–∫–∞—è': 2,
            '–ö—Ä–∞—Å–Ω–æ–≥–≤–∞—Ä–¥–µ–π—Å–∫–∞—è': 1,
            '–ö—Ä–æ–ø–æ—Ç–∫–∏–Ω—Å–∫–∞—è': 0,
            '–ü–∞—Ä–∫ –∫—É–ª—å—Ç—É—Ä—ã': 1,
            '–§—Ä—É–Ω–∑–µ–Ω—Å–∫–∞—è': 0,
            '–°–ø–æ—Ä—Ç–∏–≤–Ω–∞—è': 0,
            '–í–æ—Ä–æ–±—å—ë–≤—ã –≥–æ—Ä—ã': 0,
            '–£–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç': 0,
            '–ü—Ä–æ—Å–ø–µ–∫—Ç –í–µ—Ä–Ω–∞–¥—Å–∫–æ–≥–æ': 1,
            '–Æ–≥–æ-–ó–∞–ø–∞–¥–Ω–∞—è': 0
        };

        // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å—Ç–∞–Ω—Ü–∏—è—Ö
        const stationInfo = {
            '–°–æ–∫–æ–ª—å–Ω–∏–∫–∏': {
                name: '–°–æ–∫–æ–ª—å–Ω–∏–∫–∏',
                line: '–°–æ–∫–æ–ª—å–Ω–∏—á–µ—Å–∫–∞—è',
                coords: '55.7887, 37.6797',
                escalators: 2,
                cameras: 2,
                lastIncident: '20.09.2025'
            },
            '–ö—Ä–∞—Å–Ω—ã–µ –≤–æ—Ä–æ—Ç–∞': {
                name: '–ö—Ä–∞—Å–Ω—ã–µ –≤–æ—Ä–æ—Ç–∞',
                line: '–°–æ–∫–æ–ª—å–Ω–∏—á–µ—Å–∫–∞—è', 
                coords: '55.7687, 37.6346',
                escalators: 3,
                cameras: 1,
                lastIncident: '–°–µ–≥–æ–¥–Ω—è 14:35'
            },
            '–ß–∏—Å—Ç—ã–µ –ø—Ä—É–¥—ã': {
                name: '–ß–∏—Å—Ç—ã–µ –ø—Ä—É–¥—ã',
                line: '–°–æ–∫–æ–ª—å–Ω–∏—á–µ—Å–∫–∞—è',
                coords: '55.7653, 37.6387',
                escalators: 2,
                cameras: 2,
                lastIncident: '–°–µ–≥–æ–¥–Ω—è 12:10'
            },
            '–õ—É–±—è–Ω–∫–∞': {
                name: '–õ—É–±—è–Ω–∫–∞',
                line: '–°–æ–∫–æ–ª—å–Ω–∏—á–µ—Å–∫–∞—è',
                coords: '55.7587, 37.6281',
                escalators: 4,
                cameras: 3,
                lastIncident: '19.09.2025'
            },
            '–û—Ö–æ—Ç–Ω—ã–π —Ä—è–¥': {
                name: '–û—Ö–æ—Ç–Ω—ã–π —Ä—è–¥',
                line: '–°–æ–∫–æ–ª—å–Ω–∏—á–µ—Å–∫–∞—è',
                coords: '55.7570, 37.6156',
                escalators: 3,
                cameras: 2,
                lastIncident: '–°–µ–≥–æ–¥–Ω—è 13:22'
            },
            '–¢–≤–µ—Ä—Å–∫–∞—è': {
                name: '–¢–≤–µ—Ä—Å–∫–∞—è',
                line: '–ó–∞–º–æ—Å–∫–≤–æ—Ä–µ—Ü–∫–∞—è',
                coords: '55.7664, 37.6043',
                escalators: 2,
                cameras: 2,
                lastIncident: '–°–µ–≥–æ–¥–Ω—è 11:45'
            }
        };

        // Theme toggle functionality
        function initThemeToggle() {
            const themeToggle = document.getElementById('theme-toggle');
            const body = document.body;
            
            if (!themeToggle) return;
            
            // Check for saved theme preference or default to light
            const currentTheme = localStorage.getItem('theme') || 'light';
            body.setAttribute('data-theme', currentTheme);
            themeToggle.textContent = currentTheme === 'dark' ? '‚òÄÔ∏è' : 'üåô';

            themeToggle.addEventListener('click', () => {
                const isCurrentlyDark = body.getAttribute('data-theme') === 'dark';
                const newTheme = isCurrentlyDark ? 'light' : 'dark';
                
                body.setAttribute('data-theme', newTheme);
                themeToggle.textContent = newTheme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
                localStorage.setItem('theme', newTheme);
            });
        }

        // Mobile navigation functionality
        function initMobileNavigation() {
            const mobileMenuToggle = document.getElementById('mobile-menu-toggle');
            const mobileNav = document.getElementById('mobile-nav');
            const mobileNavClose = document.getElementById('mobile-nav-close');
            const mobileNavLinks = document.querySelectorAll('.mobile-nav-link');

            if (mobileMenuToggle && mobileNav) {
                mobileMenuToggle.addEventListener('click', () => {
                    mobileNav.classList.add('active');
                });
            }

            if (mobileNavClose && mobileNav) {
                mobileNavClose.addEventListener('click', () => {
                    mobileNav.classList.remove('active');
                });
            }

            // Close mobile nav when clicking outside
            if (mobileNav) {
                mobileNav.addEventListener('click', (e) => {
                    if (e.target === mobileNav) {
                        mobileNav.classList.remove('active');
                    }
                });
            }

            // Mobile navigation links
            mobileNavLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    
                    // Remove active class from all links
                    document.querySelectorAll('.nav-link, .mobile-nav-link').forEach(l => l.classList.remove('active'));
                    
                    // Add active class to clicked link and corresponding desktop link
                    link.classList.add('active');
                    const targetPage = link.getAttribute('data-page');
                    const desktopLink = document.querySelector(`.nav-link[data-page="${targetPage}"]`);
                    if (desktopLink) {
                        desktopLink.classList.add('active');
                    }
                    
                    // Show corresponding page
                    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
                    const targetPageElement = document.getElementById(targetPage);
                    if (targetPageElement) {
                        targetPageElement.classList.add('active');
                    }
                    
                    // Close mobile nav
                    if (mobileNav) {
                        mobileNav.classList.remove('active');
                    }
                });
            });
        }

        // Desktop navigation functionality
        function initDesktopNavigation() {
            const navLinks = document.querySelectorAll('.nav-link');
            
            navLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    
                    // Remove active class from all links
                    document.querySelectorAll('.nav-link, .mobile-nav-link').forEach(l => l.classList.remove('active'));
                    
                    // Add active class to clicked link and corresponding mobile link
                    link.classList.add('active');
                    const targetPage = link.getAttribute('data-page');
                    const mobileLink = document.querySelector(`.mobile-nav-link[data-page="${targetPage}"]`);
                    if (mobileLink) {
                        mobileLink.classList.add('active');
                    }
                    
                    // Show corresponding page
                    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
                    const targetPageElement = document.getElementById(targetPage);
                    if (targetPageElement) {
                        targetPageElement.classList.add('active');
                    }
                });
            });
        }

        // Mobile controls functionality
        function toggleMobileControls() {
            mobileControlsOpen = !mobileControlsOpen;
            const panel = document.getElementById('mobile-controls-panel');
            if (panel) {
                if (mobileControlsOpen) {
                    panel.classList.add('active');
                } else {
                    panel.classList.remove('active');
                }
            }
        }

        // Mobile map info functionality
        function toggleMobileMapInfo() {
            mapInfoOpen = !mapInfoOpen;
            const mapInfo = document.getElementById('map-info-mobile');
            if (mapInfo) {
                if (mapInfoOpen) {
                    mapInfo.classList.add('active');
                } else {
                    mapInfo.classList.remove('active');
                }
            }
        }

        function showMapLegend() {
            const legendContent = `–¢–µ–ø–ª–æ–≤–∞—è –∫–∞—Ä—Ç–∞ –∏–Ω—Ü–∏–¥–µ–Ω—Ç–æ–≤ –∑–∞ 24 —á–∞—Å–∞:

üü¢ –ó–µ–ª—ë–Ω—ã–π - 0 –∏–Ω—Ü–∏–¥–µ–Ω—Ç–æ–≤
üü° –ñ—ë–ª—Ç—ã–π - 1-2 –∏–Ω—Ü–∏–¥–µ–Ω—Ç–∞  
üî¥ –ö—Ä–∞—Å–Ω—ã–π - 3+ –∏–Ω—Ü–∏–¥–µ–Ω—Ç–æ–≤
‚ö´ –°–µ—Ä—ã–π - –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö

–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:
‚Ä¢ –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ: –∂–µ—Å—Ç—ã pinch –∏–ª–∏ –∫–Ω–æ–ø–∫–∏ +/-
‚Ä¢ –ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ: –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ –ø–∞–ª—å—Ü–µ–º
‚Ä¢ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è: –Ω–∞–∂–∞—Ç–∏–µ –Ω–∞ —Å—Ç–∞–Ω—Ü–∏—é`;
            
            alert(legendContent);
            toggleMobileControls(); // Close controls after showing legend
        }

        // Add vibration feedback for mobile interactions (if supported)
        function vibrateFeedback(pattern = [10]) {
            if (isMobile && 'vibrate' in navigator) {
                navigator.vibrate(pattern);
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ SVG –∫–∞—Ä—Ç—ã
        async function loadMetroMap() {
            try {
                // –ó–∞–≥—Ä—É–∂–∞–µ–º map.svg –∏–∑ –ø–∞–ø–∫–∏ —Å index.html
                const response = await fetch('map.svg');
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const svgContent = await response.text();
                const container = document.getElementById('svg-container');
                if (container) {
                    container.innerHTML = svgContent;
                    
                    svgElement = container.querySelector('svg');
                    if (svgElement) {
                        svgElement.style.width = '500%';
                        svgElement.style.height = '500%';
                        svgElement.style.cursor = isMobile ? 'default' : 'grab';
                        svgElement.style.touchAction = 'none';
                        
                        // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º —Å—Ç–∞–Ω—Ü–∏–∏ –≤ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–º SVG
                        setupStationsFromSVG();
                        setupSVGInteractivity();
                        applyHeatmap();
                    }
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ä—Ç—ã –º–µ—Ç—Ä–æ:', error);
                console.log('–ü–µ—Ä–µ–∫–ª—é—á–∞—é—Å—å –Ω–∞ –¥–µ–º–æ-–∫–∞—Ä—Ç—É...');
                
                // Fallback –Ω–∞ –¥–µ–º–æ-–∫–∞—Ä—Ç—É –µ—Å–ª–∏ map.svg –Ω–µ –Ω–∞–π–¥–µ–Ω
                try {
                    const svgContent = createDemoSVG();
                    const container = document.getElementById('svg-container');
                    if (container) {
                        container.innerHTML = svgContent;
                        
                        svgElement = container.querySelector('svg');
                        if (svgElement) {
                            svgElement.style.width = '100%';
                            svgElement.style.height = '100%';
                            svgElement.style.cursor = isMobile ? 'default' : 'grab';
                            svgElement.style.touchAction = 'none';
                            
                            setupSVGInteractivity();
                            applyHeatmap();
                        }
                    }
                } catch (fallbackError) {
                    const container = document.getElementById('svg-container');
                    if (container) {
                        container.innerHTML = '<div style="display: flex; align-items: center; justify-content: center; height: 100%; color: var(--text-secondary); text-align: center; padding: 2rem;">‚ö†Ô∏è<br>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ä—Ç—ã –º–µ—Ç—Ä–æ<br><small>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–ª–∏—á–∏–µ —Ñ–∞–π–ª–∞ map.svg</small></div>';
                    }
                }
            }
        }

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å—Ç–∞–Ω—Ü–∏–π –≤ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–º SVG
        function setupStationsFromSVG() {
            if (!svgElement) return;

            // –ò—â–µ–º –≤—Å–µ –∫—Ä—É–≥–ª—ã–µ –æ–±—ä–µ–∫—Ç—ã (—Å—Ç–∞–Ω—Ü–∏–∏) –≤ SVG
            const circles = svgElement.querySelectorAll('circle');
            
            circles.forEach(circle => {
                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Å—Ç–∞–Ω—Ü–∏–∏ –ø–æ —Ä–∞–∑–º–µ—Ä—É (–æ–±—ã—á–Ω–æ —Å—Ç–∞–Ω—Ü–∏–∏ –∏–º–µ—é—Ç —Ä–∞–¥–∏—É—Å –±–æ–ª—å—à–µ 8)
                const radius = parseFloat(circle.getAttribute('r') || '0');
                if (radius >= 8) {
                    // –î–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å –º–µ—Ç—Ä–æ —Å—Ç–∞–Ω—Ü–∏–∏
                    circle.classList.add('metro-station');
                    
                    // –ü–æ–ª—É—á–∞–µ–º ID —ç–ª–µ–º–µ–Ω—Ç–∞ –¥–ª—è —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è —Å –¥–∞–Ω–Ω—ã–º–∏
                    const elementId = circle.getAttribute('id');
                    let stationName = null;
                    
                    // –ò—â–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –≤ –º–∞–ø–ø–∏–Ω–≥–µ
                    for (const [name, id] of Object.entries(stationMapping)) {
                        if (id === elementId) {
                            stationName = name;
                            break;
                        }
                    }
                    
                    // –ï—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏ –≤ –º–∞–ø–ø–∏–Ω–≥–µ, –ø—ã—Ç–∞–µ–º—Å—è –∏–∑–≤–ª–µ—á—å –∏–∑ ID –∏–ª–∏ —Å–æ—Å–µ–¥–Ω–∏—Ö —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
                    if (!stationName) {
                        // –ò—â–µ–º –±–ª–∏–∂–∞–π—à–∏–π —Ç–µ–∫—Å—Ç–æ–≤—ã–π —ç–ª–µ–º–µ–Ω—Ç
                        const textElements = svgElement.querySelectorAll('text');
                        let closestText = null;
                        let minDistance = Infinity;
                        
                        const cx = parseFloat(circle.getAttribute('cx') || '0');
                        const cy = parseFloat(circle.getAttribute('cy') || '0');
                        
                        textElements.forEach(textEl => {
                            const x = parseFloat(textEl.getAttribute('x') || '0');
                            const y = parseFloat(textEl.getAttribute('y') || '0');
                            const distance = Math.sqrt(Math.pow(cx - x, 2) + Math.pow(cy - y, 2));
                            
                            if (distance < minDistance && distance < 50) { // –í –ø—Ä–µ–¥–µ–ª–∞—Ö 50 –µ–¥–∏–Ω–∏—Ü
                                minDistance = distance;
                                closestText = textEl.textContent.trim();
                            }
                        });
                        
                        if (closestText) {
                            stationName = closestText;
                        } else {
                            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∏–º—è –∏–∑ ID
                            stationName = elementId ? elementId.replace(/[^a-zA-Z–∞-—è–ê-–Ø]/g, ' ').trim() : '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è —Å—Ç–∞–Ω—Ü–∏—è';
                        }
                    }
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º –∞—Ç—Ä–∏–±—É—Ç data-station
                    circle.setAttribute('data-station', stationName);
                    
                    // –°–æ–∑–¥–∞–µ–º –∏ –¥–æ–±–∞–≤–ª—è–µ–º title —ç–ª–µ–º–µ–Ω—Ç –¥–ª—è tooltip
                    let titleElement = circle.querySelector('title');
                    if (!titleElement) {
                        titleElement = document.createElementNS('http://www.w3.org/2000/svg', 'title');
                        circle.appendChild(titleElement);
                    }
                    
                    // –ü–æ–ª—É—á–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å—Ç–∞–Ω—Ü–∏–∏
                    const info = stationInfo[stationName];
                    const incidents = incidentData[stationName] || 0;
                    
                    let titleText;
                    if (info) {
                        titleText = `${info.name}
–õ–∏–Ω–∏—è: ${info.line}
–≠—Å–∫–∞–ª–∞—Ç–æ—Ä–æ–≤: ${info.escalators}
–ö–∞–º–µ—Ä: ${info.cameras}
–ò–Ω—Ü–∏–¥–µ–Ω—Ç–æ–≤ –∑–∞ 24—á: ${incidents}
–ü–æ—Å–ª–µ–¥–Ω–∏–π –∏–Ω—Ü–∏–¥–µ–Ω—Ç: ${info.lastIncident}`;
                    } else {
                        titleText = `${stationName}
–ò–Ω—Ü–∏–¥–µ–Ω—Ç–æ–≤ –∑–∞ 24—á: ${incidents}
–°—Ç–∞—Ç—É—Å: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥`;
                    }
                    
                    titleElement.textContent = titleText;
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç–∏–ª–∏ –¥–ª—è hover —ç—Ñ—Ñ–µ–∫—Ç–∞
                    circle.style.cursor = 'pointer';
                    circle.style.transition = 'transform 0.2s ease, filter 0.2s ease';
                    
                    console.log(`–ù–∞—Å—Ç—Ä–æ–µ–Ω–∞ —Å—Ç–∞–Ω—Ü–∏—è: ${stationName} (ID: ${elementId})`);
                }
            });
            
            console.log(`–ù–∞–π–¥–µ–Ω–æ –∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ ${circles.length} —Å—Ç–∞–Ω—Ü–∏–π –≤ SVG –∫–∞—Ä—Ç–µ`);
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ –¥–µ–º–æ SVG (–≤ —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–æ–µ–∫—Ç–µ –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è map.svg)
        function createDemoSVG() {
            const stationRadius = isMobile ? '16' : '12';
            const lineWidth = isMobile ? '10' : '8';
            const fontSize = isMobile ? '14' : '12';
            
            return `
                <svg viewBox="0 0 800 600" xmlns="http://www.w3.org/2000/svg">
                    <!-- –°–æ–∫–æ–ª—å–Ω–∏—á–µ—Å–∫–∞—è –ª–∏–Ω–∏—è -->
                    <line x1="50" y1="300" x2="750" y2="300" stroke="#ed1b35" stroke-width="${lineWidth}"/>
                    
                    <!-- –ó–∞–º–æ—Å–∫–≤–æ—Ä–µ—Ü–∫–∞—è –ª–∏–Ω–∏—è -->
                    <line x1="400" y1="50" x2="400" y2="550" stroke="#44b85c" stroke-width="${lineWidth}"/>
                    
                    <!-- –°—Ç–∞–Ω—Ü–∏–∏ –°–æ–∫–æ–ª—å–Ω–∏—á–µ—Å–∫–æ–π –ª–∏–Ω–∏–∏ -->
                    <circle id="s1_1_Sokolniki" class="metro-station" cx="100" cy="300" r="${stationRadius}" fill="white" stroke="#ed1b35" stroke-width="4" data-station="–°–æ–∫–æ–ª—å–Ω–∏–∫–∏"/>
                    <text x="100" y="${isMobile ? '275' : '285'}" text-anchor="middle" font-size="${fontSize}" fill="var(--text-primary)" font-weight="500">–°–æ–∫–æ–ª—å–Ω–∏–∫–∏</text>
                    
                    <circle id="s1_Krasniye_Vorota" class="metro-station" cx="200" cy="300" r="${stationRadius}" fill="white" stroke="#ed1b35" stroke-width="4" data-station="–ö—Ä–∞—Å–Ω—ã–µ –≤–æ—Ä–æ—Ç–∞"/>
                    <text x="200" y="${isMobile ? '275' : '285'}" text-anchor="middle" font-size="${fontSize}" fill="var(--text-primary)" font-weight="500">–ö—Ä–∞—Å–Ω—ã–µ –≤–æ—Ä–æ—Ç–∞</text>
                    
                    <circle id="s1_1_Chistye_Prudy" class="metro-station" cx="300" cy="300" r="${stationRadius}" fill="white" stroke="#ed1b35" stroke-width="4" data-station="–ß–∏—Å—Ç—ã–µ –ø—Ä—É–¥—ã"/>
                    <text x="300" y="${isMobile ? '275' : '285'}" text-anchor="middle" font-size="${fontSize}" fill="var(--text-primary)" font-weight="500">–ß–∏—Å—Ç—ã–µ –ø—Ä—É–¥—ã</text>
                    
                    <circle id="s1_2_Lubyanka" class="metro-station" cx="400" cy="300" r="${stationRadius}" fill="white" stroke="#ed1b35" stroke-width="4" data-station="–õ—É–±—è–Ω–∫–∞"/>
                    <text x="400" y="${isMobile ? '275' : '285'}" text-anchor="middle" font-size="${fontSize}" fill="var(--text-primary)" font-weight="500">–õ—É–±—è–Ω–∫–∞</text>
                    
                    <circle id="s1_1_Okhotny_Ryad" class="metro-station" cx="500" cy="300" r="${stationRadius}" fill="white" stroke="#ed1b35" stroke-width="4" data-station="–û—Ö–æ—Ç–Ω—ã–π —Ä—è–¥"/>
                    <text x="500" y="${isMobile ? '275' : '285'}" text-anchor="middle" font-size="${fontSize}" fill="var(--text-primary)" font-weight="500">–û—Ö–æ—Ç–Ω—ã–π —Ä—è–¥</text>
                    
                    <circle id="s1_2_Park_Kultury" class="metro-station" cx="600" cy="300" r="${stationRadius}" fill="white" stroke="#ed1b35" stroke-width="4" data-station="–ü–∞—Ä–∫ –∫—É–ª—å—Ç—É—Ä—ã"/>
                    <text x="600" y="${isMobile ? '275' : '285'}" text-anchor="middle" font-size="${fontSize}" fill="var(--text-primary)" font-weight="500">–ü–∞—Ä–∫ –∫—É–ª—å—Ç—É—Ä—ã</text>
                    
                    <!-- –°—Ç–∞–Ω—Ü–∏–∏ –ó–∞–º–æ—Å–∫–≤–æ—Ä–µ—Ü–∫–æ–π –ª–∏–Ω–∏–∏ -->
                    <circle id="s2_7_Tverskaya" class="metro-station" cx="400" cy="150" r="${stationRadius}" fill="white" stroke="#44b85c" stroke-width="4" data-station="–¢–≤–µ—Ä—Å–∫–∞—è"/>
                    <text x="400" y="${isMobile ? '125' : '135'}" text-anchor="middle" font-size="${fontSize}" fill="var(--text-primary)" font-weight="500">–¢–≤–µ—Ä—Å–∫–∞—è</text>
                    
                    <circle id="s2_3_Teatralnaya" class="metro-station" cx="400" cy="250" r="${stationRadius}" fill="white" stroke="#44b85c" stroke-width="4" data-station="–¢–µ–∞—Ç—Ä–∞–ª—å–Ω–∞—è"/>
                    <text x="430" y="255" text-anchor="start" font-size="${fontSize}" fill="var(--text-primary)" font-weight="500">–¢–µ–∞—Ç—Ä–∞–ª—å–Ω–∞—è</text>
                    
                    <circle id="s2_2_Novokuznetskaya" class="metro-station" cx="400" cy="350" r="${stationRadius}" fill="white" stroke="#44b85c" stroke-width="4" data-station="–ù–æ–≤–æ–∫—É–∑–Ω–µ—Ü–∫–∞—è"/>
                    <text x="430" y="355" text-anchor="start" font-size="${fontSize}" fill="var(--text-primary)" font-weight="500">–ù–æ–≤–æ–∫—É–∑–Ω–µ—Ü–∫–∞—è</text>
                    
                    <circle id="s2_3_Paveletskaya" class="metro-station" cx="400" cy="450" r="${stationRadius}" fill="white" stroke="#44b85c" stroke-width="4" data-station="–ü–∞–≤–µ–ª–µ—Ü–∫–∞—è"/>
                    <text x="400" y="${isMobile ? '475' : '465'}" text-anchor="middle" font-size="${fontSize}" fill="var(--text-primary)" font-weight="500">–ü–∞–≤–µ–ª–µ—Ü–∫–∞—è</text>
                </svg>
            `;
        }

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ SVG
        function setupSVGInteractivity() {
            if (!svgElement) return;

            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è —Å—Ç–∞–Ω—Ü–∏–π
            const stations = svgElement.querySelectorAll('.metro-station');
            stations.forEach(station => {
                station.style.cursor = 'pointer';
                
                // –û—Å–Ω–æ–≤–Ω—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
                station.addEventListener('click', handleStationClick);
                
                // Hover —ç—Ñ—Ñ–µ–∫—Ç—ã —Ç–æ–ª—å–∫–æ –¥–ª—è desktop
                if (!('ontouchstart' in window)) {
                    station.addEventListener('mouseenter', handleStationHover);
                    station.addEventListener('mouseleave', handleStationLeave);
                    
                    // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ hover —ç—Ñ—Ñ–µ–∫—Ç—ã
                    station.addEventListener('mouseenter', (e) => {
                        e.target.style.transform = 'scale(1.2)';
                        e.target.style.filter = 'drop-shadow(0 0 8px rgba(59, 130, 246, 0.6))';
                        e.target.style.zIndex = '10';
                    });
                    
                    station.addEventListener('mouseleave', (e) => {
                        e.target.style.transform = 'scale(1)';
                        e.target.style.filter = 'none';
                        e.target.style.zIndex = 'auto';
                    });
                }
            });

            // Touch —Å–æ–±—ã—Ç–∏—è –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
            if (isMobile) {
                setupTouchEvents();
            } else {
                // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ drag & drop –¥–ª—è desktop
                svgElement.addEventListener('mousedown', startDragging);
                svgElement.addEventListener('mousemove', drag);
                svgElement.addEventListener('mouseup', stopDragging);
                svgElement.addEventListener('mouseleave', stopDragging);
                svgElement.addEventListener('wheel', handleWheel);
            }
            
            console.log(`–ù–∞—Å—Ç—Ä–æ–µ–Ω–∞ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–ª—è ${stations.length} —Å—Ç–∞–Ω—Ü–∏–π`);
        }

        // Touch events for mobile gestures
        function setupTouchEvents() {
            if (!svgElement) return;

            let touchStartX, touchStartY;
            let lastTouchDistance = 0;
            let isMultiTouch = false;

            svgElement.addEventListener('touchstart', (e) => {
                e.preventDefault();
                
                if (e.touches.length === 1) {
                    // Single touch - start dragging
                    const touch = e.touches[0];
                    touchStartX = touch.clientX - panX;
                    touchStartY = touch.clientY - panY;
                    isDragging = true;
                    isMultiTouch = false;
                } else if (e.touches.length === 2) {
                    // Multi-touch - prepare for zoom
                    isMultiTouch = true;
                    isDragging = false;
                    const touch1 = e.touches[0];
                    const touch2 = e.touches[1];
                    lastTouchDistance = Math.sqrt(
                        Math.pow(touch2.clientX - touch1.clientX, 2) +
                        Math.pow(touch2.clientY - touch1.clientY, 2)
                    );
                }
            }, { passive: false });

            svgElement.addEventListener('touchmove', (e) => {
                e.preventDefault();
                
                if (e.touches.length === 1 && isDragging && !isMultiTouch) {
                    // Single touch - dragging
                    const touch = e.touches[0];
                    panX = touch.clientX - touchStartX;
                    panY = touch.clientY - touchStartY;
                    updateTransform();
                } else if (e.touches.length === 2 && isMultiTouch) {
                    // Multi-touch - zooming
                    const touch1 = e.touches[0];
                    const touch2 = e.touches[1];
                    const currentDistance = Math.sqrt(
                        Math.pow(touch2.clientX - touch1.clientX, 2) +
                        Math.pow(touch2.clientY - touch1.clientY, 2)
                    );
                    
                    if (lastTouchDistance > 0) {
                        const scale = currentDistance / lastTouchDistance;
                        zoomMap(scale);
                    }
                    lastTouchDistance = currentDistance;
                }
            }, { passive: false });

            svgElement.addEventListener('touchend', (e) => {
                e.preventDefault();
                isDragging = false;
                isMultiTouch = false;
                lastTouchDistance = 0;
            }, { passive: false });
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–≤–µ–¥–µ–Ω–∏—è –Ω–∞ —Å—Ç–∞–Ω—Ü–∏—é
        function handleStationHover(event) {
            const stationName = event.target.getAttribute('data-station');
            if (stationName) {
                const info = stationInfo[stationName];
                const incidents = incidentData[stationName] || 0;
                
                updateStationInfo(stationName, info || {name: stationName}, incidents);
            }
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–∞ –ø–æ —Å—Ç–∞–Ω—Ü–∏–∏
        function handleStationClick(event) {
            event.stopPropagation();
            const stationName = event.target.getAttribute('data-station');
            if (stationName) {
                vibrateFeedback([20]); // Vibration feedback
                
                const info = stationInfo[stationName];
                const incidents = incidentData[stationName] || 0;
                
                updateStationInfo(stationName, info || {name: stationName}, incidents);
                
                if (isMobile) {
                    // –ù–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—É—é –ø–∞–Ω–µ–ª—å
                    if (!mapInfoOpen) {
                        toggleMobileMapInfo();
                    }
                    // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–±–∏–ª—å–Ω—ã–µ –∫–æ–Ω—Ç—Ä–æ–ª—ã –µ—Å–ª–∏ –æ—Ç–∫—Ä—ã—Ç—ã
                    if (mobileControlsOpen) {
                        toggleMobileControls();
                    }
                } else {
                    // –ù–∞ –¥–µ—Å–∫—Ç–æ–ø–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–µ—Ç–∞–ª–∏
                    if (info) {
                        showStationDetails(stationName);
                    } else {
                        alert(`–°—Ç–∞–Ω—Ü–∏—è: ${stationName}\n–ò–Ω—Ü–∏–¥–µ–Ω—Ç–æ–≤ –∑–∞ 24—á: ${incidents}\n\n–î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–∞ –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö.`);
                    }
                }
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Å—Ç–∞–Ω—Ü–∏–∏
        function updateStationInfo(stationName, info, incidents) {
            let content;
            if (info && info.name) {
                content = `
                    <strong>${info.name}</strong><br>
                    –õ–∏–Ω–∏—è: ${info.line || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}<br>
                    –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã: ${info.coords || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}<br>
                    –≠—Å–∫–∞–ª–∞—Ç–æ—Ä–æ–≤: ${info.escalators || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}<br>
                    –ö–∞–º–µ—Ä: ${info.cameras || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}<br>
                    –ò–Ω—Ü–∏–¥–µ–Ω—Ç–æ–≤ –∑–∞ 24—á: ${incidents}<br>
                    –ü–æ—Å–ª–µ–¥–Ω–∏–π –∏–Ω—Ü–∏–¥–µ–Ω—Ç: ${info.lastIncident || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}
                `;
            } else {
                content = `
                    <strong>${stationName}</strong><br>
                    –ò–Ω—Ü–∏–¥–µ–Ω—Ç–æ–≤ –∑–∞ 24—á: ${incidents}<br>
                    –°—Ç–∞—Ç—É—Å: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥<br>
                    <small>–î–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏–∑ –ë–î</small>
                `;
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ–±–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–µ –ø–∞–Ω–µ–ª–∏
            const stationInfoElement = document.getElementById('station-info');
            const stationInfoMobileElement = document.getElementById('station-info-mobile');
            
            if (stationInfoElement) {
                stationInfoElement.innerHTML = content;
            }
            if (stationInfoMobileElement) {
                stationInfoMobileElement.innerHTML = content;
            }
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —É—Ö–æ–¥–∞ –∫—É—Ä—Å–æ—Ä–∞ —Å–æ —Å—Ç–∞–Ω—Ü–∏–∏
        function handleStationLeave() {
            if (!isMobile) {
                const stationInfoElement = document.getElementById('station-info');
                if (stationInfoElement) {
                    stationInfoElement.innerHTML = '–ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ —Å—Ç–∞–Ω—Ü–∏—é –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏';
                }
            }
        }

        // –ü–æ–∫–∞–∑ –¥–µ—Ç–∞–ª–µ–π —Å—Ç–∞–Ω—Ü–∏–∏
        function showStationDetails(stationName) {
            const info = stationInfo[stationName];
            const incidents = incidentData[stationName] || 0;
            
            if (info) {
                alert(`–°—Ç–∞–Ω—Ü–∏—è: ${info.name}
–õ–∏–Ω–∏—è: ${info.line}
–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã: ${info.coords}
–≠—Å–∫–∞–ª–∞—Ç–æ—Ä–æ–≤: ${info.escalators}
–ö–∞–º–µ—Ä: ${info.cameras}
–ò–Ω—Ü–∏–¥–µ–Ω—Ç–æ–≤ –∑–∞ 24 —á–∞—Å–∞: ${incidents}
–ü–æ—Å–ª–µ–¥–Ω–∏–π –∏–Ω—Ü–∏–¥–µ–Ω—Ç: ${info.lastIncident}

–í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –æ—Ç–∫—Ä–æ–µ—Ç—Å—è –¥–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å—Ç–∞–Ω—Ü–∏–∏.`);
            }
        }

        // –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Ç–µ–ø–ª–æ–≤–æ–π –∫–∞—Ä—Ç—ã
        function applyHeatmap() {
            if (!svgElement || !showHeatmap) return;

            const stations = svgElement.querySelectorAll('.metro-station');
            stations.forEach(station => {
                const stationName = station.getAttribute('data-station');
                const incidents = incidentData[stationName] || 0;
                
                let color = '#6b7280'; // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å–µ—Ä—ã–π
                let animation = '';
                
                if (incidents === 0) {
                    color = '#22c55e'; // –ó–µ–ª—ë–Ω—ã–π
                } else if (incidents <= 2) {
                    color = '#f59e0b'; // –ñ—ë–ª—Ç—ã–π
                } else {
                    color = '#ef4444'; // –ö—Ä–∞—Å–Ω—ã–π
                    animation = 'pulse 2s infinite';
                }
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è stroke –∏ fill
                const originalStroke = station.getAttribute('stroke') || station.style.stroke;
                const originalFill = station.getAttribute('fill') || station.style.fill;
                
                // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ü–≤–µ—Ç–∞ —Ç–µ–ø–ª–æ–≤–æ–π –∫–∞—Ä—Ç—ã
                station.setAttribute('fill', color);
                station.style.animation = animation;
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
                station.setAttribute('data-original-stroke', originalStroke);
                station.setAttribute('data-original-fill', originalFill);
            });
            
            console.log(`–ü—Ä–∏–º–µ–Ω–µ–Ω–∞ —Ç–µ–ø–ª–æ–≤–∞—è –∫–∞—Ä—Ç–∞ –∫ ${stations.length} —Å—Ç–∞–Ω—Ü–∏—è–º`);
        }

        // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ–º
        function zoomMap(factor) {
            currentZoom *= factor;
            
            // Different zoom limits for mobile vs desktop
            const minZoom = isMobile ? 0.3 : 0.5;
            const maxZoom = isMobile ? 8 : 5;
            
            currentZoom = Math.max(minZoom, Math.min(maxZoom, currentZoom));
            updateTransform();
            
            // Update coordinate display
            const coordDisplay = document.getElementById('coord-display');
            if (coordDisplay) {
                coordDisplay.textContent = `–ú–∞—Å—à—Ç–∞–±: ${Math.round(currentZoom * 100)}%`;
            }
        }

        function centerMap() {
            panX = 0;
            panY = 0;
            currentZoom = 1;
            updateTransform();
            
            const coordDisplay = document.getElementById('coord-display');
            if (coordDisplay) {
                coordDisplay.textContent = showHeatmap ? '–¢–µ–ø–ª–æ–≤–∞—è –∫–∞—Ä—Ç–∞: –∏–Ω—Ü–∏–¥–µ–Ω—Ç—ã –∑–∞ 24—á' : '–û–±—ã—á–Ω—ã–π —Ä–µ–∂–∏–º –∫–∞—Ä—Ç—ã';
            }
            
            // Close mobile controls after action
            if (isMobile && mobileControlsOpen) {
                setTimeout(toggleMobileControls, 300);
            }
        }

        function resetView() {
            panX = 0;
            panY = 0;
            currentZoom = 1;
            showHeatmap = true;
            updateTransform();
            applyHeatmap();
            
            const coordDisplay = document.getElementById('coord-display');
            if (coordDisplay) {
                coordDisplay.textContent = '–¢–µ–ø–ª–æ–≤–∞—è –∫–∞—Ä—Ç–∞: –∏–Ω—Ü–∏–¥–µ–Ω—Ç—ã –∑–∞ 24—á';
            }
            
            // Reset mobile button states
            if (isMobile) {
                const heatmapButton = document.querySelector('.mobile-control-btn:nth-child(4)');
                if (heatmapButton) {
                    heatmapButton.style.backgroundColor = 'var(--primary-color)';
                    heatmapButton.style.color = 'white';
                }
            }
            
            // Close mobile controls after action
            if (isMobile && mobileControlsOpen) {
                setTimeout(toggleMobileControls, 300);
            }
        }

        function updateTransform() {
            if (svgElement) {
                // Use transform3d for better mobile performance
                const transform = `translate3d(${panX}px, ${panY}px, 0) scale(${currentZoom})`;
                svgElement.style.transform = transform;
                svgElement.style.transformOrigin = 'center center';
                
                // Add will-change for better mobile performance during animations
                svgElement.style.willChange = 'transform';
                
                // Remove will-change after animation to save resources
                setTimeout(() => {
                    if (svgElement) {
                        svgElement.style.willChange = 'auto';
                    }
                }, 500);
            }
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–ª–µ—Å–∏–∫–∞ –º—ã—à–∏ –¥–ª—è –∑—É–º–∞
        function handleWheel(event) {
            event.preventDefault();
            const delta = event.deltaY;
            const factor = delta > 0 ? 0.9 : 1.1;
            zoomMap(factor);
        }

        // –ü–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ –∫–∞—Ä—Ç—ã
        function startDragging(event) {
            if (event.target.classList.contains('metro-station')) return;
            
            isDragging = true;
            startX = event.clientX - panX;
            startY = event.clientY - panY;
            if (svgElement) {
                svgElement.style.cursor = 'grabbing';
            }
        }

        function drag(event) {
            if (!isDragging) return;
            
            panX = event.clientX - startX;
            panY = event.clientY - startY;
            updateTransform();
        }

        function stopDragging() {
            isDragging = false;
            if (svgElement) {
                svgElement.style.cursor = 'grab';
            }
        }

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç–µ–ø–ª–æ–≤–æ–π –∫–∞—Ä—Ç—ã
        function toggleHeatmap() {
            showHeatmap = !showHeatmap;
            
            if (showHeatmap) {
                applyHeatmap();
                const coordDisplay = document.getElementById('coord-display');
                if (coordDisplay) {
                    coordDisplay.textContent = '–¢–µ–ø–ª–æ–≤–∞—è –∫–∞—Ä—Ç–∞: –∏–Ω—Ü–∏–¥–µ–Ω—Ç—ã –∑–∞ 24—á';
                }
                
                // Mobile feedback
                if (isMobile) {
                    const button = document.querySelector('.mobile-control-btn:nth-child(4)');
                    if (button) {
                        button.style.backgroundColor = 'var(--primary-color)';
                        button.style.color = 'white';
                    }
                }
            } else {
                // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ —Ü–≤–µ—Ç–∞
                const stations = svgElement.querySelectorAll('.metro-station');
                stations.forEach(station => {
                    const originalFill = station.getAttribute('data-original-fill') || 'white';
                    const originalStroke = station.getAttribute('data-original-stroke') || '#ed1b35';
                    
                    station.setAttribute('fill', originalFill);
                    station.setAttribute('stroke', originalStroke);
                    station.style.animation = '';
                });
                
                const coordDisplay = document.getElementById('coord-display');
                if (coordDisplay) {
                    coordDisplay.textContent = '–û–±—ã—á–Ω—ã–π —Ä–µ–∂–∏–º –∫–∞—Ä—Ç—ã';
                }
                
                // Reset mobile button
                if (isMobile) {
                    const button = document.querySelector('.mobile-control-btn:nth-child(4)');
                    if (button) {
                        button.style.backgroundColor = '';
                        button.style.color = '';
                    }
                }
            }
            
            // Close mobile controls after action
            if (isMobile && mobileControlsOpen) {
                setTimeout(toggleMobileControls, 300);
            }
        }

        // Window resize handler
        function handleResize() {
            const wasMobile = isMobile;
            isMobile = window.innerWidth <= 768;
            
            // If switching between mobile/desktop, reinitialize interactions
            if (wasMobile !== isMobile && svgElement) {
                setupSVGInteractivity();
            }
            
            // Close mobile nav if switching to desktop
            const mobileNav = document.getElementById('mobile-nav');
            if (!isMobile && mobileNav) {
                mobileNav.classList.remove('active');
            }
            
            // Show/hide user info based on screen size
            const userInfo = document.querySelector('.user-info');
            if (userInfo) {
                userInfo.style.display = isMobile ? 'none' : 'block';
            }
        }

        // Export functionality
        function exportChart(chartId) {
            const chart = document.getElementById(chartId);
            if (!chart) return;
            
            const formatSelect = chart.parentElement.querySelector('.export-select');
            const format = formatSelect ? formatSelect.value : 'pdf';
            
            // Simulate export process
            const chartTitle = chart.parentElement.querySelector('.card-title').textContent;
            
            // Show loading state
            const exportBtn = chart.parentElement.querySelector('.export-btn');
            if (exportBtn) {
                const originalText = exportBtn.innerHTML;
                exportBtn.innerHTML = '‚è≥ –≠–∫—Å–ø–æ—Ä—Ç...';
                exportBtn.disabled = true;
                
                setTimeout(() => {
                    alert(`–≠–∫—Å–ø–æ—Ä—Ç "${chartTitle}" –≤ —Ñ–æ—Ä–º–∞—Ç–µ ${format.toUpperCase()} –∑–∞–≤–µ—Ä—à–µ–Ω`);
                    exportBtn.innerHTML = originalText;
                    exportBtn.disabled = false;
                    
                    // In real implementation, this would trigger file download
                    console.log(`Exporting ${chartId} as ${format}`);
                }, 2000);
            }
        }

        function generateReport(reportType) {
            const formatSelect = document.getElementById(`${reportType}-format`);
            const format = formatSelect ? formatSelect.value : 'pdf';
            
            const reportNames = {
                'daily': '–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –æ—Ç—á–µ—Ç',
                'weekly': '–ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç', 
                'monthly': '–ú–µ—Å—è—á–Ω—ã–π –æ—Ç—á–µ—Ç',
                'station': '–û—Ç—á–µ—Ç –ø–æ —Å—Ç–∞–Ω—Ü–∏–∏'
            };
            
            const reportName = reportNames[reportType] || reportType;
            
            // Simulate report generation
            alert(`–ì–µ–Ω–µ—Ä–∞—Ü–∏—è "${reportName}" –≤ —Ñ–æ—Ä–º–∞—Ç–µ ${format.toUpperCase()} –Ω–∞—á–∞—Ç–∞. –§–∞–π–ª –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è —á–µ—Ä–µ–∑ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥.`);
            
            // In real implementation, this would call backend API
            console.log(`Generating ${reportType} report in ${format} format`);
        }

        // Modal functions
        function viewIncident(incidentId) {
            const modal = document.getElementById('incident-modal');
            if (modal) {
                modal.classList.add('active');
            }
        }

        function closeModal() {
            const modal = document.getElementById('incident-modal');
            if (modal) {
                modal.classList.remove('active');
            }
        }

        function createIncident() {
            alert('–§–æ—Ä–º–∞ —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–≥–æ –∏–Ω—Ü–∏–¥–µ–Ω—Ç–∞');
        }

        function viewStation(stationId) {
            alert(`–ü—Ä–æ—Å–º–æ—Ç—Ä –¥–µ—Ç–∞–ª–µ–π —Å—Ç–∞–Ω—Ü–∏–∏: ${stationId}`);
        }

        // Initialize mobile controls toggle
        function initMobileControls() {
            const mobileControlsToggle = document.getElementById('mobile-controls-toggle');
            if (mobileControlsToggle) {
                mobileControlsToggle.addEventListener('click', toggleMobileControls);
            }
        }

        // Close mobile controls when clicking outside
        function setupOutsideClickHandlers() {
            document.addEventListener('click', (e) => {
                const mobileControls = document.querySelector('.mobile-controls');
                const mobileControlsPanel = document.getElementById('mobile-controls-panel');
                
                if (mobileControlsOpen && mobileControls && !mobileControls.contains(e.target)) {
                    toggleMobileControls();
                }
            });

            // Close modal when clicking outside
            const incidentModal = document.getElementById('incident-modal');
            if (incidentModal) {
                incidentModal.addEventListener('click', (e) => {
                    if (e.target.classList.contains('modal')) {
                        closeModal();
                    }
                });
            }
        }

        // Initialize everything when DOM is loaded
        function initializeApp() {
            console.log('Initializing EscControl application...');
            
            // Initialize all components
            initThemeToggle();
            initMobileNavigation();
            initDesktopNavigation();
            initMobileControls();
            setupOutsideClickHandlers();
            
            // Set initial mobile state
            isMobile = window.innerWidth <= 768;
            
            // Show/hide user info based on initial screen size
            const userInfo = document.querySelector('.user-info');
            if (userInfo) {
                userInfo.style.display = isMobile ? 'none' : 'block';
            }

            // Add window resize listener
            window.addEventListener('resize', handleResize);
            
            // Load metro map with delay for proper initialization
            setTimeout(() => {
                loadMetroMap();
            }, 100);

            console.log('EscControl application initialized successfully');
        }

        // Simulate real-time updates
        function startRealTimeUpdates() {
            setInterval(() => {
                // In real implementation, this would fetch updates from the server
                // and update the UI accordingly
                console.log('Checking for updates...');
            }, 30000); // Check every 30 seconds
        }

        // Wait for DOM to be fully loaded
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeApp);
        } else {
            initializeApp();
        }

        // Start real-time updates
        startRealTimeUpdates();
    </script>
</body>
</html>
